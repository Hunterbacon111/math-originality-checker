# 📷 图片识别功能使用指南

## 功能介绍

支持老师通过**上传图片**方式输入数学题目，AI自动识别题目内容，然后进行质量审核或原创度检测。

---

## ✨ 功能特点

### 1. 多种输入方式
- **💬 文字输入** - 传统方式，直接输入
- **📷 图片上传** - 新功能，上传截图/照片

### 2. 智能 OCR 识别
- 使用 **GPT-4o Vision** 模型
- 支持手写和印刷体
- 准确识别数学公式和符号
- 识别图表和几何图形

### 3. 灵活编辑
- AI识别后可以手动编辑修改
- 确保准确性

---

## 📋 使用步骤

### 方法 1：文字输入（原有功能）

1. 选择 **"💬 文字输入"**
2. 在文本框中输入题目
3. 点击"质量审核"或"原创度检测"

### 方法 2：图片上传（新功能）

1. 选择 **"📷 图片上传"**
2. 点击"选择图片文件"上传图片
   - 支持格式：PNG、JPG、JPEG、WEBP
   - 来源：截图、拍照、扫描件
3. 预览上传的图片
4. 点击 **"🤖 AI识别题目"** 按钮
5. 等待 5-10 秒，AI识别题目内容
6. 查看识别结果（可编辑修改）
7. 点击"质量审核"或"原创度检测"

---

## 📸 支持的图片类型

### ✅ 推荐

- **清晰的截图** - 最佳效果
- **印刷体题目** - 识别准确度高
- **工整的手写** - 可以识别
- **白底黑字** - 对比度高，效果好

### ⚠️ 可能识别不佳

- 过于模糊的图片
- 光线不足的照片
- 倾斜角度过大
- 背景复杂干扰多

### 💡 拍摄建议

1. **光线充足** - 避免反光和阴影
2. **对准题目** - 填满画面
3. **保持水平** - 不要倾斜
4. **清晰聚焦** - 文字清晰可见
5. **简洁背景** - 减少干扰

---

## 🔧 技术实现

### 使用的模型

- **GPT-4o Vision** - 图片识别
  - 最新的多模态模型
  - 支持图片理解
  - 准确识别数学符号

- **GPT-5.1** - 质量审核
- **DeepSeek R1** - 原创度检测（联网搜索）

### 识别能力

✅ **能识别**：
- 中文和英文文字
- 数学符号：+、-、×、÷、=、≠、≤、≥
- 希腊字母：α、β、γ、θ、π
- 上下标：x²、aⁿ、log₂
- 分数：½、¾
- 根号：√、∛
- 积分：∫、∮
- 求和：Σ
- 矩阵和行列式
- 几何图形描述

❌ **可能难以识别**：
- 极度潦草的手写
- 严重模糊的文字
- 复杂的几何图形细节

---

## 💰 成本说明

### API 调用费用

```
GPT-4o Vision (图片识别):
- 输入: 约 $0.002/图片
- 输出: 约 $0.001/图片

总计约 $0.003/图片

GPT-5.1 + DeepSeek R1 (审核):
- 约 $0.02-0.05/题

完整流程: 约 $0.025-0.055/题
```

---

## 🚀 部署步骤

### 本地测试

```bash
cd /Users/fangheli/math-originality-checker

# 安装新依赖
source .venv/bin/activate
pip install Pillow==10.0.0

# 使用图片识别版本
cp app_with_image.py app.py

# 测试运行
streamlit run app.py
```

### 部署到阿里云

```bash
# 在服务器上
cd /root/math-originality-checker

# 拉取最新代码
git pull

# 切换到图片识别版本
cp app_with_image.py app.py

# 重新构建（安装 Pillow）
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# 查看日志
docker-compose logs -f
```

---

## 🧪 测试示例

### 测试 1：简单打印题目

拍摄或截图一个简单的数学题目：
```
求解方程：2x + 3 = 11
```

上传后点击"AI识别"，应该能准确识别。

### 测试 2：包含公式的题目

```
已知函数 f(x) = x² - 4x + 3
求该函数的最小值
```

### 测试 3：几何题目

包含图形的题目，如：
```
在△ABC中，∠C=90°，AC=3，BC=4
求斜边AB的长度
```

---

## ❓ 常见问题

### Q1: 图片识别失败怎么办？

**A:** 
1. 检查图片是否清晰
2. 重新拍摄或截图
3. 或使用文字输入方式

### Q2: 识别结果有误怎么办？

**A:** 
识别结果显示在可编辑的文本框中，直接修改即可。

### Q3: 支持的图片大小？

**A:** 
- 推荐：1-5 MB
- 最大：20 MB
- 分辨率：无特别要求，清晰即可

### Q4: 识别需要多长时间？

**A:** 
通常 5-10 秒，取决于：
- 图片大小
- 网络速度
- API 响应时间

### Q5: 可以识别手写题目吗？

**A:** 
可以，但要求：
- 字迹工整
- 笔迹清晰
- 不要过于潦草

---

## 🔒 隐私与安全

- ✅ 图片仅用于识别，不保存
- ✅ 识别后的文字也不保存
- ✅ 所有数据都是临时处理
- ✅ 符合教育场景隐私要求

---

## 📊 优势对比

| 输入方式 | 优点 | 缺点 | 适用场景 |
|---------|------|------|---------|
| **文字输入** | 精确、快速 | 输入慢、公式复杂 | 简单题目 |
| **图片上传** | 方便、快捷 | 需要识别、可能有误 | 试卷、书本 |

**建议**：
- 快速审核 → 图片上传
- 重要题目 → 文字输入或识别后仔细校对

---

## 🎯 未来计划

- [ ] 支持批量上传（多张图片）
- [ ] 支持 PDF 文件上传
- [ ] 改进手写识别准确度
- [ ] 支持直接拍照（移动端）
- [ ] 添加图形绘制功能

---

需要帮助？查看日志：
```bash
docker-compose logs -f
```

